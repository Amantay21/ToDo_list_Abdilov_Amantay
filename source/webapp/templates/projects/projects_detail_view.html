{% extends 'base.html' %}

{% block menu %}

    <a class="nav-link" aria-current="page"  href="{% url 'webapp:index' %}">На главную</a>
    {% if perms.webapp.change_project %}
    <a class="nav-link" aria-current="page" href="{% url 'webapp:projects_update' project.pk%}">Изменить проект</a>
    {% endif %}
    {% if perms.webapp.delete_project %}
    <a class="nav-link" aria-current="page" href="{% url 'webapp:projects_delete' project.pk%}">Удалить проект</a>
    {% endif %}
    {% if perms.webapp.add_task and request.user in project.users.all %}
    <a class="nav-link" aria-current="page" href="{% url 'webapp:tasks_create' project.pk%}">Добавить задачу</a>
    {% endif %}
    {% if perms.webapp.edit_users_in_project and request.user in project.users.all %}
    <a class="nav-link" aria-current="page" href="{% url 'webapp:edit_project_users' project.pk%}"
    >Добавить пользователя</a>
    {% endif %}
{% endblock %}

{% block content %}
    <h1>Project</h1>


        <div class="card" >
            <div class="card-body">
                <h3 class="card-title">{{ project.title }}</h3>
                <h5 class="card-title">{{ project.description }}</h5>
                <p class="card-text" > Участники:
                    {% for user in project.users.all %}
                    {{ user.title }} {% if forloop.last %}.{% else %}, {% endif %}
                {% empty %}
                        нет участников
                    {% endfor %}
                </p>
                <p class="card-text">start date: {{ project.start_date }}</p>
                <p class="card-text">End date: {{ project.end_date }}</p>
            {% if perms.webapp.change_project and request.user in project.users.all %}
                <li><a href="{% url 'webapp:projects_update' project.pk%}">Edit</a></li>
            {% endif %}
            {% if perms.webapp.change_project and request.user in project.users.all %}
                <li><a href="{% url 'webapp:projects_delete' project.pk%}">Delete</a></li>
            {% endif %}
            </div>
        </div>


    <div class="tasks d-flex justify-content-start row g-4">
    {% for task in project.tasks.all %}
        <div class="col-sm-12 col-md-6 col-lg-3 d-flex flex-row mb-3">
        <div class="card my-3 " style="width: 18rem;">
            <div class="card-body ">
                <h5 class="card-title">{{ task.title }}</h5>
                <h5 class="card-title">{{ task.get_status_display }}</h5>
                <h6 class="card-subtitle mb-2 text-body-secondary">{{ task.description }}</h6>
                <h6 class="card-subtitle mb-2 text-body-secondary">{{ task.updated_date }}</h6>
                <h6 class="card-subtitle mb-2 ">Типы: {% for types in task.types.all %}
                  {{ types.title }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}</h6>
                <p><a href="{% url 'webapp:tasks_view' pk=task.pk %}" class="card-link">Подробнее...</a></p>
                <p><a href="{% url 'webapp:task_update' pk=task.pk %}" class="card-link">Редактировать</a></p>
                <p><a href="{% url 'webapp:task_delete' pk=task.pk %}" class="card-link" >Delete</a></p>

            </div>
        </div>
        </div>

        {% empty %}
        нет задач
    {% endfor %}
    </div>
{% endblock %}
